name: Naming Check

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  naming:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true

      - name: Build naming binary (release)
        run: cargo build --release --bin naming

      - name: Run naming check for all crates
        run: |
          CRATES=(architecture knowledge memories naming repository shared task)
          for crate in "${CRATES[@]}"; do
            echo "ğŸ” Kiá»ƒm tra naming cho crates/$crate/src ..."
            OUTPUT=$(./target/release/naming "crates/$crate/src" 2>&1)
            echo "$OUTPUT"
            if echo "$OUTPUT" | grep -q '\[VIOLATION\]'; then
              echo "âŒ Vi pháº¡m Ä‘á»‹nh danh Ä‘Æ¡n tá»« á»Ÿ crates/$crate."
              exit 1
            fi
            echo "âœ… crates/$crate: KhÃ´ng cÃ³ vi pháº¡m naming nÃ o."
          done
          echo "ğŸ‰ ToÃ n bá»™ workspace khÃ´ng cÃ³ vi pháº¡m naming!" 